{% extends "letters/base.html" %}
{% block content %}

<h2>Conversation with {{ other_user.username }}</h2>

{% for letter in letters %}
    {% with v=letter.versions.last %}
    <div class="card">

        <b>
            {% if letter.sender == user %}
                You
            {% else %}
                {{ letter.sender.username }}
            {% endif %}
        </b>

        <p style="margin-top:8px;">
            {{ v.content }}
        </p>

        {% if not v.approved %}
            <p style="color:#f59e0b;">âš  Modification requested</p>

            {% if user == letter.sender and not v.approved and v.id %}
    <a href="{% url 'approve_modification' v.id %}"
       style="color:#22c55e;font-weight:600;">
        Accept Modification
    </a>
{% endif %}
        {% endif %}

        {% if user == letter.receiver and v.approved %}
            <a href="{% url 'modify' letter.id %}"
               style="color:#a78bfa;">
                Request Modification
            </a>
        {% endif %}

    </div>
    {% endwith %}
{% empty %}
<p>No letters yet</p>
{% endfor %}

<a href="{% url 'send_letter' other_user.id %}" class="fab">
    Write Letter
</a>

{% endblock %}
