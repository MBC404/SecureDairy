{% extends "letters/base.html" %}

{% block content %}

<h2 style="margin-bottom:20px;">
    Conversation with {{ other_user.username }}
</h2>

<div style="max-width:900px; margin:auto;">

    {% for v in versions %}
        <div class="card"
             style="
                margin-bottom:20px;
                padding:18px;
                border-radius:10px;
                background:#0f172a;
                border:1px solid #1e293b;
             ">

            <!-- Metadata -->
            <div style="font-size:13px; color:#94a3b8; margin-bottom:6px;">
                <strong>Message ID:</strong> {{ v.id }} |
                {{ v.created_at|date:"d M Y, h:i A" }}
            </div>

            <!-- Message content -->
            <div style="font-size:15px; line-height:1.6; color:#e5e7eb;">
                {{ v.content }}
            </div>

            <!-- Status -->
            <div style="margin-top:10px; font-size:14px;">

                {% if v.approved %}
                    <span style="color:#22c55e;">✔ Approved</span>
                {% else %}
                    <span style="color:#f59e0b;">⏳ Pending Modification</span>
                {% endif %}

            </div>

            <!-- Actions -->
            <div style="margin-top:12px;">

                <!-- Sender can approve pending modifications -->
                {% if not v.approved and user == letter.sender %}
                    <a href="{% url 'approve_modification' v.id %}"
                       style="
                            color:#22c55e;
                            font-weight:500;
                            text-decoration:none;
                       ">
                        Approve Modification
                    </a>
                {% endif %}

                <!-- Receiver can request modification ONLY on approved versions -->
                {% if v.approved and user == letter.receiver %}
                    <a href="{% url 'modify' letter.id %}"
                       style="
                            margin-left:15px;
                            color:#a78bfa;
                            font-weight:500;
                            text-decoration:none;
                       ">
                        Request Modification
                    </a>
                {% endif %}

            </div>
        </div>

    {% empty %}
        <p style="color:#94a3b8;">No messages yet.</p>
    {% endfor %}

</div>

{% endblock %}
