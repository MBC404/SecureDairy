{% extends "letters/base.html" %}
{% block content %}

<h2>Conversation with {{ other_user.username }}</h2>

<div class="chat">
{% for letter in letters %}
    {% with letter.versions.last as v %}
    <div class="bubble {% if letter.sender == user %}sent{% else %}recv{% endif %}">
        <div class="meta">
            {% if letter.sender == user %}You{% else %}{{ letter.sender.username }}{% endif %}
            · {{ letter.created_at|date:"M d, H:i" }}
        </div>

        {{ v.content }}

        {% if user == letter.receiver %}
        <div style="margin-top:12px;">
            <a href="{% url 'modify' letter.id %}" class="btn warn">
                Request Modification
            </a>
        </div>
        {% endif %}
    </div>
    {% endwith %}
{% empty %}
<p style="color:var(--muted)">No messages yet</p>
{% endfor %}
</div>

<a href="{% url 'send_letter' other_user.id %}" class="fab">✉ New Letter</a>

{% endblock %}
